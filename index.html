<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Subway Runner ساده</title>
<style>
  body {
    margin: 0;
    background: linear-gradient(to top, #1e3c72, #2a5298);
    overflow: hidden;
    font-family: Arial, sans-serif;
    user-select: none;
  }
  #score {
    position: absolute;
    top: 15px;
    left: 15px;
    font-size: 24px;
    color: #fff;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000;
  }
  canvas {
    display: block;
    margin: 60px auto 0;
    background: #71c5f9;
    border-radius: 10px;
    box-shadow: 0 0 15px #0008;
  }
</style>
</head>
<body>

<div id="score">امتیاز: 0</div>
<canvas id="game" width="400" height="600"></canvas>

<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const laneCount = 3;
  const laneWidth = canvas.width / laneCount;
  const groundY = canvas.height - 100;

  // بازیکن
  const player = {
    lane: 1, // وسط (0 چپ، 1 وسط، 2 راست)
    x: laneWidth * 1 + laneWidth / 2,
    y: groundY - 50,
    width: 40,
    height: 50,
    isJumping: false,
    jumpVelocity: 0,
    gravity: 1,
    baseY: groundY - 50,
    animFrame: 0
  };

  // موانع و سکه‌ها
  let obstacles = [];
  let coins = [];

  let obstacleSpeed = 6;
  let score = 0;

  const scoreDisplay = document.getElementById('score');

  // انیمیشن دویدن ساده (تغییر رنگ)
  const playerColors = ['#ff4500', '#ff6347', '#ff7f50', '#ff4500'];

  // ایجاد مانع جدید در خط تصادفی
  function createObstacle() {
    let lane = Math.floor(Math.random() * laneCount);
    obstacles.push({
      lane,
      x: laneWidth * lane + laneWidth / 2 - 20,
      y: groundY - 40,
      width: 40,
      height: 40,
      color: '#444'
    });
  }

  // ایجاد سکه جدید در خط تصادفی
  function createCoin() {
    let lane = Math.floor(Math.random() * laneCount);
    coins.push({
      lane,
      x: laneWidth * lane + laneWidth / 2 - 15,
      y: groundY - 80,
      width: 30,
      height: 30,
      color: 'yellow'
    });
  }

  // رسم بازیکن
  function drawPlayer() {
    ctx.fillStyle = playerColors[player.animFrame];
    let playerX = laneWidth * player.lane + laneWidth / 2 - player.width / 2;
    ctx.fillRect(playerX, player.y, player.width, player.height);
  }

  // رسم موانع
  function drawObstacles() {
    obstacles.forEach(ob => {
      ctx.fillStyle = ob.color;
      ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
    });
  }

  // رسم سکه‌ها (دایره زرد)
  function drawCoins() {
    coins.forEach(coin => {
      ctx.fillStyle = coin.color;
      ctx.beginPath();
      ctx.arc(coin.x + coin.width/2, coin.y + coin.height/2, coin.width / 2, 0, Math.PI * 2);
      ctx.fill();
    });
  }

  // آپدیت موقعیت موانع و سکه‌ها
  function updateObstacles() {
    obstacles.forEach((ob, idx) => {
      ob.y += obstacleSpeed;
      if (ob.y > canvas.height) obstacles.splice(idx,1);
    });
  }

  function updateCoins() {
    coins.forEach((coin, idx) => {
      coin.y += obstacleSpeed;
      if (coin.y > canvas.height) coins.splice(idx,1);
    });
  }

  // چک برخورد بازیکن با مانع یا سکه
  function checkCollision() {
    let playerX = laneWidth * player.lane + laneWidth / 2 - player.width / 2;
    let playerY = player.y;
    let pW = player.width;
    let pH = player.height;

    // برخورد با موانع
    for (const ob of obstacles) {
      if (
        player.lane === ob.lane &&
        playerX < ob.x + ob.width &&
        playerX + pW > ob.x &&
        playerY < ob.y + ob.height &&
        playerY + pH > ob.y
      ) {
        return 'obstacle';
      }
    }
    // برخورد با سکه‌ها
    for (let i = 0; i < coins.length; i++) {
      let coin = coins[i];
      if (
        player.lane === coin.lane &&
        playerX < coin.x + coin.width &&
        playerX + pW > coin.x &&
        playerY < coin.y + coin.height &&
        playerY + pH > coin.y
      ) {
        coins.splice(i, 1);
        score += 5; // امتیاز سکه
        updateScore();
      }
    }

    return null;
  }

  // به‌روزرسانی امتیاز
  function updateScore() {
    scoreDisplay.textContent = 'امتیاز: ' + score;
  }

  // حرکت بازیکن به چپ و راست
  function moveLeft() {
    if (player.lane > 0) player.lane--;
  }
  function moveRight() {
    if (player.lane < laneCount - 1) player.lane++;
  }

  // پرش
  function jump() {
    if (!player.isJumping) {
      player.isJumping = true;
      player.jumpVelocity = -15;
    }
  }

  function updatePlayer() {
    if (player.isJumping) {
      player.y += player.jumpVelocity;
      player.jumpVelocity += player.gravity;
      if (player.y >= player.baseY) {
        player.y = player.baseY;
        player.isJumping = false;
      }
    }
    // انیمیشن دویدن ساده
    player.animFrame = (player.animFrame + 1) % playerColors.length;
  }

  // حلقه اصلی بازی
  let frameCounter = 0;
  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // بک‌گراند و زمین
    ctx.fillStyle = '#71c5f9';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#2e8b57';
    ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

    drawPlayer();
    drawObstacles();
    drawCoins();

    updatePlayer();
    updateObstacles();
    updateCoins();

    // هر 90 فریم مانع جدید
    if (frameCounter % 90 === 0) {
      createObstacle();
    }

    // هر 150 فریم سکه جدید
    if (frameCounter % 150 === 0) {
      createCoin();
    }

    frameCounter++;

    // افزایش سرعت هر 20 امتیاز
    if (score > 0 && score % 20 === 0 && frameCounter % 90 === 0) {
      obstacleSpeed += 0.5;
    }

    let collision = checkCollision();
    if (collision === 'obstacle') {
      alert('باختی! امتیاز: ' + score + '\nرفرش کن برای بازی دوباره.');
      window.location.reload();
    }

    requestAnimationFrame(gameLoop);
  }

  // کنترل صفحه کلید
  window.addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft') moveLeft();
    else if (e.key === 'ArrowRight') moveRight();
    else if (e.key === ' ' || e.key === 'ArrowUp') jump();
  });

  // کنترل لمسی ساده (کلیک چپ و راست صفحه برای تغییر خط، تاچ بالا برای پرش)
  let touchStartX = 0;
  let touchStartY = 0;
  window.addEventListener('touchstart', e => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });
  window.addEventListener('touchend', e => {
    let touchEndX = e.changedTouches[0].clientX;
    let touchEndY = e.changedTouches[0].clientY;
    let diffX = touchEndX - touchStartX;
    let diffY = touchEndY - touchStartY;

    if (Math.abs(diffX) > Math.abs(diffY)) {
      if (diffX > 30) moveRight();
      else if (diffX < -30) moveLeft();
    } else {
      if (diffY < -30) jump();
    }
  });

  updateScore();
  gameLoop();
</script>

</body>
</html>
